{{define "chat" }}
    <div class="flex-1 flex flex-col">
        {{if gt (len .PageData.TargetUser)  0}}
            <div class="border-b py-8 px-4 flex items-center h-fit">
                Chatting with {{.PageData.TargetUser}}
            </div>

            <div class="bg-black p-6 grid gap-6 self-end w-full">
                <div id="messages" class="grid gap-6 w-full">
                    {{range .PageData.Messages}}
                        {{template "message" .}}
                    {{end}}
                </div>
                {{template "form" .FormData}}
            </div>
        {{end}}
    </div>

    <script>
        if(window.location.href.indexOf("chat") > -1) {
            const chattingWith = '{{.PageData.TargetUser}}';
            const user = '{{.PageData.User.Username}}'
            const url = `ws://${window.location.host}/ws/${chattingWith}`;
            const ws = new WebSocket(url);
            ws.onopen = () => console.log("WebSocket connection established");
            ws.onclose = () => console.log("WebSocket connection closed");
            ws.onerror = (error) => console.log("WebSocket error:", error);
            ws.onmessage = (event) => {
            const data = JSON.parse(event.data);
                const messages = document.getElementById("messages");
                const message = document.createElement("div");
                message.innerHTML = `            
                    <div class="flex gap-4 items-center">
                    <p>${data.sender}</p>
                    <p class="bg-accent p-2 rounded w-1/2">${data.message}</p>
                    </div> 
                `;
                messages.appendChild(message);
            };
        };
    </script>
{{end}}





